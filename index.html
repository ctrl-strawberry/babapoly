<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Baba Poly</title>
  <script>
    window.BABA_POLY_AVATAR_ENDPOINT = "https://baba-poly-worker.babapoly.workers.dev/api/edit-avatar";
  </script>
  <link rel="icon" type="image/png" href="assets/logo.png">
  <link rel="stylesheet" href="css/baba-poly.css">
  <link rel="stylesheet" href="css/navbar.css">
</head>
<body>
  <div class="app-shell">
    <header id="homeHeader">
      <button class="btn btn-ghost image-lab-launcher" type="button" id="openImageLabBtn" aria-label="Abrir laboratorio de imágenes">
        Laboratorio IA
      </button>
      <button class="settings-terminal-btn" id="settingsToggle" aria-pressed="false" aria-label="Activar modo ajustes">
        <span class="terminal-title">BABAPOLY</span><span class="terminal-cursor" aria-hidden="true">_</span>
      </button>
    </header>
    <main>
      <section id="screen-inicio" class="active">
        <div class="home-content">
          <div class="player-toolbar" id="playerToolbar" hidden>
            <button id="addPlayerBtn" class="add-player-btn" type="button">
              <span class="svg-wrapper">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 12.5a4 4 0 10-4-4 4 4 0 004 4zm0 1.5c-4.2 0-7.25 2.43-7.25 6.05 0 .53.43.95.96.95h12.58c.53 0 .96-.42.96-.95C19.25 14.93 16.2 14 12 14zM20 8.75h-1.75V7a.75.75 0 10-1.5 0v1.75H15a.75.75 0 100 1.5h1.75V12a.75.75 0 101.5 0v-1.75H20a.75.75 0 000-1.5z"></path>
                </svg>
              </span>
              <span>Añadir jugador</span>
            </button>
          </div>
          <div class="player-list" id="playerList"></div>
        </div>
      </section>

      <section id="screen-jimbo">
        <h2 class="section-title">Jimbo Arena</h2>
        <div id="jimboSelect" class="selector-grid"></div>
        <div id="battleStage" class="battle-stage" hidden>
          <div class="battle-scene">
            <img src="assets/campo.gif" alt="Campo de batalla" loading="lazy">
            <div class="battle-info battle-info-player">
              <div class="battle-info-head">
                <span id="playerPetLabel" class="battle-info-name"></span>
                <div class="battle-info-level" id="playerLevelLabel"></div>
              </div>
              <div class="bar">
                <div class="bar-fill" id="playerHealthFill"></div>
                <span class="bar-value" id="playerHealthText"></span>
              </div>
            </div>
            <div class="battle-info battle-info-enemy">
              <div class="battle-info-head">
                <span id="enemyLabel" class="battle-info-name"></span>
                <div class="battle-info-level" id="enemyLevelLabel"></div>
              </div>
              <div class="bar">
                <div class="bar-fill enemy" id="enemyHealthFill"></div>
                <span class="bar-value" id="enemyHealthText"></span>
              </div>
            </div>
            <img src="assets/mascota.webp" alt="Mascota del jugador" class="battle-character battle-character-player" loading="lazy">
            <img src="assets/enemigo.gif" alt="Enemigo" class="battle-character battle-character-enemy" loading="lazy">
          </div>
          <div class="battle-panel">
            <div id="attackGrid" class="attack-grid"></div>
          </div>
        </div>
      </section>

      <section id="screen-image-lab" aria-labelledby="imageLabTitle">
        <div class="image-lab">
          <div class="image-lab-top">
            <button class="btn btn-ghost" type="button" id="imageLabBackBtn" aria-label="Volver a Inicio">
              ← Volver a Inicio
            </button>
            <span class="image-lab-status" id="imageLabStatus"></span>
          </div>
          <h2 id="imageLabTitle" class="section-title">Laboratorio de imágenes</h2>
          <p class="helper-text image-lab-description">
            Prueba llamadas a tu backend y a la API de Google para depurar la generación de avatares. Esta herramienta sólo se sirve en local; no expongas la clave públicamente.
          </p>
          <div class="image-lab-grid">
            <form id="imageLabForm" class="image-lab-panel" autocomplete="off">
              <fieldset>
                <legend>Entrada</legend>
                <label for="imageLabFile" class="image-lab-label">Imagen base</label>
                <input type="file" id="imageLabFile" accept="image/*">
                <div class="image-lab-actions">
                  <button class="btn btn-ghost" type="button" id="imageLabSampleBtn">Usar mascota de ejemplo</button>
                  <button class="btn btn-ghost" type="button" id="imageLabClearBtn">Limpiar</button>
                </div>

                <figure class="image-lab-preview">
                  <img id="imageLabSourcePreview" alt="Vista previa de la imagen base" loading="lazy">
                  <figcaption id="imageLabSourceInfo" class="helper-text">Carga una imagen para comenzar.</figcaption>
                </figure>

                <label for="imageLabPrompt" class="image-lab-label">Prompt</label>
                <textarea id="imageLabPrompt" rows="3" spellcheck="false"></textarea>

                <div class="image-lab-inline">
                  <div>
                    <label for="imageLabModel" class="image-lab-label">Modelo</label>
                    <input type="text" id="imageLabModel" value="gemini-2.5-flash-image">
                  </div>
                  <div>
                    <label for="imageLabMode" class="image-lab-label">Modo</label>
                    <select id="imageLabMode">
                      <option value="edit">Editar imagen subida</option>
                      <option value="generate">Generar desde prompt</option>
                    </select>
                  </div>
                </div>

                <label for="imageLabEndpoint" class="image-lab-label">Endpoint del backend</label>
                <input type="url" id="imageLabEndpoint" placeholder="/api/edit-avatar">

                <label for="imageLabAdvancedJson" class="image-lab-label">Campos extra (JSON opcional)</label>
                <textarea id="imageLabAdvancedJson" rows="4" spellcheck="false" placeholder='{"editConfig":{"referenceSubjectStrength":0.4}}'></textarea>
                <span class="helper-text">Se fusiona con el cuerpo enviado al backend y a Google.</span>

                <label class="image-lab-checkbox">
                  <input type="checkbox" id="imageLabIncludeRaw">
                  Incluir respuesta cruda de Google en la salida del backend
                </label>

                <div class="image-lab-actions">
                  <button class="btn btn-primary" type="button" id="imageLabBackendBtn">Probar backend</button>
                </div>

                <details class="image-lab-direct">
                  <summary>Prueba directa con la API de Google (uso local)</summary>
                  <label for="imageLabApiKey" class="image-lab-label">Clave de Google</label>
                  <input type="password" id="imageLabApiKey" autocomplete="off" placeholder="AIza...">
                  <span class="helper-text">La clave sólo se usa desde tu navegador. No la compartas.</span>
                  <button class="btn btn-ghost" type="button" id="imageLabDirectBtn">Llamar a Google directamente</button>
                </details>
              </fieldset>
            </form>

            <div class="image-lab-panel image-lab-results">
              <h3>Resultados</h3>
              <div class="image-lab-preview-grid">
                <figure class="image-lab-preview">
                  <img id="imageLabResultPreview" alt="Resultado de la llamada" loading="lazy">
                  <figcaption id="imageLabResultInfo" class="helper-text">Aún no hay resultados.</figcaption>
                </figure>
              </div>

              <label for="imageLabRequestPreview" class="image-lab-label">Payloads preparados</label>
              <textarea id="imageLabRequestPreview" rows="10" readonly spellcheck="false"></textarea>

              <label for="imageLabResponsePreview" class="image-lab-label">Respuesta recibida</label>
              <textarea id="imageLabResponsePreview" rows="12" readonly spellcheck="false"></textarea>
            </div>
          </div>
        </div>
      </section>

      <section id="screen-ruleta">
        <h2 class="section-title">Ruleta Baba</h2>
        <p class="helper-text">
          Elige un jugador, apuesta una cantidad y selecciona un número. Si aciertas, multiplicas tu dinero. Después de jugar volverás a Inicio con el resultado.
        </p>
        <div class="roulette-panel">
          <div class="card">
            <label for="roulettePlayer">Jugador</label>
            <select id="roulettePlayer"></select>
            <label for="rouletteAmount">Cantidad a apostar</label>
            <input type="number" id="rouletteAmount" min="10" step="10" value="50">
            <label for="rouletteNumber">Número (0 - 36)</label>
            <input type="number" id="rouletteNumber" min="0" max="36" value="7">
            <button class="btn btn-primary" id="spinBtn">Girar ruleta</button>
            <span class="helper-text" id="rouletteHelper"></span>
          </div>
          <div class="roulette-wheel" id="rouletteWheel">
            <div class="roulette-pointer"></div>
            <strong id="rouletteResult">?</strong>
          </div>
        </div>
      </section>
    </main>
  </div>

  <template id="playerCardTemplate">
    <button class="player-card" type="button">
      <div class="player-card-content">
        <div class="player-card-info">
          <div class="player-name"></div>
          <div class="player-money"></div>
        </div>
        <div class="player-actions">
          <img class="player-avatar" alt="">
          <span
            class="player-delete-btn"
            role="button"
            data-action="delete"
            title="Eliminar jugador"
            aria-label="Eliminar jugador"
            tabindex="-1"
          >&times;</span>
        </div>
      </div>
    </button>
  </template>

  <template id="playerSelectCard">
    <div class="card">
      <strong class="player-name"></strong>
      <span class="helper-text player-money"></span>
      <button class="btn btn-primary">Enviar mascota</button>
    </div>
  </template>

  <div id="modalContainer"></div>
  <div id="toastLayer" aria-live="polite"></div>

  <nav class="bottom-nav" aria-label="Navegación principal">
    <div class="tabs-container">
      <div class="bottom-tabs">
        <input class="tab-input" type="radio" name="bottom-nav" id="bottom-nav-inicio" data-screen="inicio" checked>
        <label class="tab" for="bottom-nav-inicio" aria-label="Ir a Inicio">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M11.47 2.47a.75.75 0 0 1 1.06 0l8.25 8.25a.75.75 0 0 1-.53 1.28H19.5v7.5a.75.75 0 0 1-.75.75h-4.5a.75.75 0 0 1-.75-.75v-4.5h-2.5v4.5a.75.75 0 0 1-.75.75h-4.5a.75.75 0 0 1-.75-.75V12H3.75a.75.75 0 0 1-.53-1.28l8.25-8.25Z"/>
          </svg>
        </label>

        <input class="tab-input" type="radio" name="bottom-nav" id="bottom-nav-jimbo" data-screen="jimbo">
        <label class="tab" for="bottom-nav-jimbo" aria-label="Ir a Jimbo">
          <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <circle cx="6.2" cy="9" r="2.3"/>
            <circle cx="9.6" cy="5.4" r="2.3"/>
            <circle cx="14.4" cy="5.4" r="2.3"/>
            <circle cx="17.8" cy="9" r="2.3"/>
            <path d="M12 12.2c-3.1 0-5.6 2.5-5.6 5.6 0 1.8 1.4 3.2 3.2 3.2 1 0 1.9-.4 2.6-1 .7.6 1.6 1 2.6 1 1.8 0 3.2-1.4 3.2-3.2 0-3.1-2.5-5.6-5.6-5.6Z"/>
          </svg>
        </label>

        <input class="tab-input" type="radio" name="bottom-nav" id="bottom-nav-ruleta" data-screen="ruleta">
        <label class="tab" for="bottom-nav-ruleta" aria-label="Ir a Ruleta">
          <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <circle cx="12" cy="12" r="8.5" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="12" r="3" fill="currentColor"/>
            <path d="M12 3.5V8M20.5 12H16M12 20.5V16M3.5 12H8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            <path d="M6.2 6.2l3.1 3.1M17.8 6.2l-3.1 3.1M17.8 17.8l-3.1-3.1M6.2 17.8l3.1-3.1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </label>

        <span class="glider" aria-hidden="true"></span>
      </div>
    </div>
  </nav>

  <script type="module" src="js/main.js"></script>
</body>
</html>
